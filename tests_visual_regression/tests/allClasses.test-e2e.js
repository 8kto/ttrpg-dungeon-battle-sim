module.exports = async (page) => {
  // Listen for console errors and log them
  page.on('console', (msg) => {
    if (msg.type() === 'error') {
      console.error(`Browser console error: ${msg.text()}`)
    }
  })

  // Restore all 9 classes from serialized string
  await page.evaluateOnNewDocument(() => {
    localStorage.setItem(
      's&w-generator',
      `{"MainCharacter":{"id":"MainCharacter","name":"Main Character","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":11,"ToHit":0,"Damage":0,"Doors":"1-2","Carry":5},"Dexterity":{"Score":9,"MissilesToHit":0,"ArmorClass":0},"Constitution":{"Score":11,"HitPoints":0,"RaiseDeadSurvivalChance":"75%"},"Intelligence":{"Score":6,"MaxAdditionalLanguages":0,"MaxSpellLevel":4,"NewSpellUnderstandingChance":30,"SpellsPerLevel":"2/4"},"Wisdom":{"Score":17},"Charisma":{"Score":8,"MaxNumberOfSpecialHirelings":3},"Gold":110,"HitPoints":6},"characterClass":"Cleric","spells":"All"}},"character-name1720287035476":{"id":"character-name1720287035476","name":"Character Name","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":11,"ToHit":0,"Damage":0,"Doors":"1-2","Carry":5},"Dexterity":{"Score":16,"MissilesToHit":1,"ArmorClass":1},"Constitution":{"Score":7,"HitPoints":-1,"RaiseDeadSurvivalChance":"50%"},"Intelligence":{"Score":10,"MaxAdditionalLanguages":2,"MaxSpellLevel":5,"NewSpellUnderstandingChance":50,"SpellsPerLevel":"4/6"},"Wisdom":{"Score":11},"Charisma":{"Score":13,"MaxNumberOfSpecialHirelings":5},"Gold":100,"HitPoints":1},"characterClass":"Thief"}},"character-name1720287039511":{"id":"character-name1720287039511","name":"Character Name","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":11,"ToHit":0,"Damage":0,"Doors":"1-2","Carry":5},"Dexterity":{"Score":7,"MissilesToHit":-1,"ArmorClass":-1},"Constitution":{"Score":9,"HitPoints":0,"RaiseDeadSurvivalChance":"75%"},"Intelligence":{"Score":6,"MaxAdditionalLanguages":0,"MaxSpellLevel":4,"NewSpellUnderstandingChance":30,"SpellsPerLevel":"2/4"},"Wisdom":{"Score":9},"Charisma":{"Score":8,"MaxNumberOfSpecialHirelings":3},"Gold":120,"HitPoints":1},"characterClass":"Druid","spells":"All"}},"character-name1720287043434":{"id":"character-name1720287043434","name":"Character Name","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":13,"ToHit":1,"Damage":0,"Doors":"1-2","Carry":10},"Dexterity":{"Score":12,"MissilesToHit":0,"ArmorClass":0},"Constitution":{"Score":15,"HitPoints":1,"RaiseDeadSurvivalChance":"100%"},"Intelligence":{"Score":10,"MaxAdditionalLanguages":2,"MaxSpellLevel":5,"NewSpellUnderstandingChance":50,"SpellsPerLevel":"4/6"},"Wisdom":{"Score":16},"Charisma":{"Score":6,"MaxNumberOfSpecialHirelings":2},"Gold":80,"HitPoints":3},"characterClass":"Monk"}},"character-name1720287049959":{"id":"character-name1720287049959","name":"Character Name","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":8,"ToHit":0,"Damage":0,"Doors":"1-2","Carry":0},"Dexterity":{"Score":9,"MissilesToHit":0,"ArmorClass":0},"Constitution":{"Score":12,"HitPoints":0,"RaiseDeadSurvivalChance":"75%"},"Intelligence":{"Score":12,"MaxAdditionalLanguages":3,"MaxSpellLevel":6,"NewSpellUnderstandingChance":55,"SpellsPerLevel":"4/6"},"Wisdom":{"Score":10},"Charisma":{"Score":6,"MaxNumberOfSpecialHirelings":2},"Gold":120,"HitPoints":2},"characterClass":"MagicUser","spells":{"Shield":{"name":"Shield","level":1},"Magic Missile":{"name":"Magic Missile","level":1},"Detect Magic":{"name":"Detect Magic","level":1},"Protection from Evil":{"name":"Protection from Evil","level":1},"Read Magic":{"name":"Read Magic","level":1},"Charm Person":{"name":"Charm Person","level":1}}}},"character-name1720287054445":{"id":"character-name1720287054445","name":"Character Name","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":9,"ToHit":0,"Damage":0,"Doors":"1-2","Carry":5},"Dexterity":{"Score":11,"MissilesToHit":0,"ArmorClass":0},"Constitution":{"Score":13,"HitPoints":1,"RaiseDeadSurvivalChance":"100%"},"Intelligence":{"Score":9,"MaxAdditionalLanguages":1,"MaxSpellLevel":5,"NewSpellUnderstandingChance":45,"SpellsPerLevel":"3/5"},"Wisdom":{"Score":11},"Charisma":{"Score":8,"MaxNumberOfSpecialHirelings":3},"Gold":60,"HitPoints":3},"characterClass":"Ranger"}},"character-name1720287067510":{"id":"character-name1720287067510","name":"Character Name","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":13,"ToHit":1,"Damage":0,"Doors":"1-2","Carry":10},"Dexterity":{"Score":14,"MissilesToHit":1,"ArmorClass":1},"Constitution":{"Score":12,"HitPoints":0,"RaiseDeadSurvivalChance":"75%"},"Intelligence":{"Score":15,"MaxAdditionalLanguages":4,"MaxSpellLevel":8,"NewSpellUnderstandingChance":75,"SpellsPerLevel":"6/10"},"Wisdom":{"Score":12},"Charisma":{"Score":8,"MaxNumberOfSpecialHirelings":3},"Gold":110,"HitPoints":5},"characterClass":"Assassin"}},"character-name1720287080808":{"id":"character-name1720287080808","name":"Character Name","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":15,"ToHit":1,"Damage":0,"Doors":"1-2","Carry":10},"Dexterity":{"Score":8,"MissilesToHit":-1,"ArmorClass":-1},"Constitution":{"Score":7,"HitPoints":-1,"RaiseDeadSurvivalChance":"50%"},"Intelligence":{"Score":12,"MaxAdditionalLanguages":3,"MaxSpellLevel":6,"NewSpellUnderstandingChance":55,"SpellsPerLevel":"4/6"},"Wisdom":{"Score":15},"Charisma":{"Score":7,"MaxNumberOfSpecialHirelings":3},"Gold":100,"HitPoints":1},"characterClass":"Fighter"}},"character-name1720287096634":{"id":"character-name1720287096634","name":"Character Name","items":{"Basic accessories":{"cost":0,"name":"Basic accessories","quantity":1,"weight":8}},"character":{"stats":{"Strength":{"Score":9,"ToHit":0,"Damage":0,"Doors":"1-2","Carry":5},"Dexterity":{"Score":11,"MissilesToHit":0,"ArmorClass":0},"Constitution":{"Score":11,"HitPoints":0,"RaiseDeadSurvivalChance":"75%"},"Intelligence":{"Score":4,"MaxAdditionalLanguages":0,"MaxSpellLevel":4,"NewSpellUnderstandingChance":30,"SpellsPerLevel":"2/4"},"Wisdom":{"Score":10},"Charisma":{"Score":14,"MaxNumberOfSpecialHirelings":5},"Gold":100,"HitPoints":6},"characterClass":"Paladin"}}}`,
    )
  })

  await page.goto('http://localhost:3000', { waitUntil: 'load' })
}
